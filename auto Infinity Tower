-- ðŸŒŸ Ultimate Auto Tower System (6 Toggles + Persistent White GUI + Icon)
-- Features: Auto Behind, Auto Teleport, Auto Next Floor, Auto Tower, Auto Rejoin, Auto Start Tower
-- GUI stays even after leaving tower!

local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Workspace = game:GetService("Workspace")
local RunService = game:GetService("RunService")
local CoreGui = game:GetService("CoreGui")

local player = Players.LocalPlayer
local hrp = player.Character and player.Character:WaitForChild("HumanoidRootPart") or nil

-- Cleanup old GUI
pcall(function()
	if CoreGui:FindFirstChild("AutoSystemGUI") then
		CoreGui.AutoSystemGUI:Destroy()
	end
end)

-- Create ScreenGui
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "AutoSystemGUI"
ScreenGui.ResetOnSpawn = false
ScreenGui.Parent = CoreGui

-- Frame
local Frame = Instance.new("Frame")
Frame.Size = UDim2.new(0, 260, 0, 350)
Frame.Position = UDim2.new(0.5, -130, 0.5, -175)
Frame.BackgroundColor3 = Color3.fromRGB(250, 250, 250)
Frame.BorderSizePixel = 0
Frame.Active = true
Frame.Draggable = true
Frame.Parent = ScreenGui

Instance.new("UICorner", Frame).CornerRadius = UDim.new(0, 10)
local UIStroke = Instance.new("UIStroke", Frame)
UIStroke.Color = Color3.fromRGB(200, 200, 200)
UIStroke.Thickness = 1.5

-- Title
local Title = Instance.new("TextLabel")
Title.Size = UDim2.new(1, -60, 0, 30)
Title.Position = UDim2.new(0, 10, 0, 5)
Title.BackgroundTransparency = 1
Title.Text = "âš™ï¸ Auto Tower Tools"
Title.Font = Enum.Font.GothamBold
Title.TextSize = 18
Title.TextColor3 = Color3.fromRGB(25, 25, 25)
Title.TextXAlignment = Enum.TextXAlignment.Left
Title.Parent = Frame

-- Close Button
local CloseButton = Instance.new("TextButton")
CloseButton.Size = UDim2.new(0, 25, 0, 25)
CloseButton.Position = UDim2.new(1, -30, 0, 5)
CloseButton.BackgroundColor3 = Color3.fromRGB(255, 80, 80)
CloseButton.Text = "âœ•"
CloseButton.TextColor3 = Color3.new(1, 1, 1)
CloseButton.Font = Enum.Font.GothamBold
CloseButton.TextSize = 18
CloseButton.Parent = Frame
Instance.new("UICorner", CloseButton).CornerRadius = UDim.new(1, 0)

-- Minimize Button
local MinButton = Instance.new("TextButton")
MinButton.Size = UDim2.new(0, 25, 0, 25)
MinButton.Position = UDim2.new(1, -60, 0, 5)
MinButton.BackgroundColor3 = Color3.fromRGB(90, 170, 255)
MinButton.Text = "â€“"
MinButton.TextColor3 = Color3.new(1, 1, 1)
MinButton.Font = Enum.Font.GothamBold
MinButton.TextSize = 22
MinButton.Parent = Frame
Instance.new("UICorner", MinButton).CornerRadius = UDim.new(1, 0)

-- Icon
local Icon = Instance.new("TextButton")
Icon.Size = UDim2.new(0, 45, 0, 45)
Icon.Position = UDim2.new(1, -60, 1, -60)
Icon.AnchorPoint = Vector2.new(1, 1)
Icon.BackgroundColor3 = Color3.fromRGB(90, 170, 255)
Icon.Text = "âš™ï¸"
Icon.TextSize = 22
Icon.Font = Enum.Font.GothamBold
Icon.TextColor3 = Color3.new(1, 1, 1)
Icon.Visible = false
Icon.Parent = ScreenGui
Instance.new("UICorner", Icon).CornerRadius = UDim.new(1, 0)

MinButton.MouseButton1Click:Connect(function()
	Frame.Visible = false
	Icon.Visible = true
end)

Icon.MouseButton1Click:Connect(function()
	Frame.Visible = true
	Icon.Visible = false
end)

CloseButton.MouseButton1Click:Connect(function()
	ScreenGui:Destroy()
end)

-- Utility
local function createToggle(name, posY, callback)
	local btn = Instance.new("TextButton")
	btn.Size = UDim2.new(0, 220, 0, 40)
	btn.Position = UDim2.new(0.5, -110, 0, posY)
	btn.BackgroundColor3 = Color3.fromRGB(220, 60, 60)
	btn.TextColor3 = Color3.new(1, 1, 1)
	btn.Font = Enum.Font.GothamBold
	btn.TextSize = 16
	btn.Text = name .. ": OFF"
	btn.BorderSizePixel = 0
	Instance.new("UICorner", btn).CornerRadius = UDim.new(0, 8)
	btn.Parent = Frame

	local enabled = false
	btn.MouseButton1Click:Connect(function()
		enabled = not enabled
		btn.Text = name .. ": " .. (enabled and "ON" or "OFF")
		btn.BackgroundColor3 = enabled and Color3.fromRGB(60, 200, 90) or Color3.fromRGB(220, 60, 60)
		callback(enabled)
	end)
	return btn
end

----------------------------------------------------------------
-- Logic
----------------------------------------------------------------
local TowerRemote = ReplicatedStorage:WaitForChild("Remotes"):WaitForChild("Tower")
local CombatRemote = ReplicatedStorage:WaitForChild("Remotes"):WaitForChild("Combat")

local behindCon, teleportCon, nextCon
local autoTower, autoRejoin, autoStart = false, false, false
local towerActive = false

-- Auto Behind
createToggle("Auto Behind", 50, function(state)
	if behindCon then behindCon:Disconnect() end
	if state then
		behindCon = RunService.Heartbeat:Connect(function()
			local char = player.Character
			if not char or not char:FindFirstChild("HumanoidRootPart") then return end
			local hrp = char.HumanoidRootPart
			local enemies = Workspace:FindFirstChild("Client") and Workspace.Client:FindFirstChild("Enemies")
			if not enemies then return end

			local closest, dist
			for _, e in ipairs(enemies:GetChildren()) do
				local root = e:FindFirstChild("HumanoidRootPart")
				local hum = e:FindFirstChild("Humanoid")
				if root and hum and hum.Health > 0 then
					local d = (root.Position - hrp.Position).Magnitude
					if not dist or d < dist then
						dist = d
						closest = root
					end
				end
			end
			if closest then
				hrp.CFrame = CFrame.new(closest.Position - closest.CFrame.LookVector * 4 + Vector3.new(0, 2, 0), closest.Position)
			end
		end)
	end
end)

-- Auto Teleport
createToggle("Auto Teleport", 100, function(state)
	if teleportCon then teleportCon:Disconnect() end
	if state then
		teleportCon = RunService.Heartbeat:Connect(function()
			local char = player.Character
			if not char or not char:FindFirstChild("HumanoidRootPart") then return end
			local hrp = char.HumanoidRootPart
			local enemies = Workspace:FindFirstChild("Client") and Workspace.Client:FindFirstChild("Enemies")
			if not enemies then return end

			local closest, dist
			for _, e in ipairs(enemies:GetChildren()) do
				local root = e:FindFirstChild("HumanoidRootPart")
				local hum = e:FindFirstChild("Humanoid")
				if root and hum and hum.Health > 0 then
					local d = (root.Position - hrp.Position).Magnitude
					if not dist or d < dist then
						dist = d
						closest = root
					end
				end
			end
			if closest then
				hrp.CFrame = closest.CFrame * CFrame.new(0, 0, 3)
			end
		end)
	end
end)

-- Auto Next Floor
createToggle("Auto Next Floor", 150, function(state)
	if nextCon then nextCon:Disconnect() end
	if state then
		nextCon = RunService.Heartbeat:Connect(function()
			pcall(function()
				TowerRemote:FireServer("NextFloor")
			end)
			task.wait(0.4)
		end)
	end
end)

-- Auto Tower
createToggle("Auto Tower", 200, function(state)
	autoTower = state
end)

-- Auto Rejoin
createToggle("Auto Rejoin", 250, function(state)
	autoRejoin = state
end)

-- Auto Start Tower
createToggle("Auto Start Tower", 300, function(state)
	autoStart = state
	if state then
		task.spawn(function()
			while autoStart do
				pcall(function()
					TowerRemote:FireServer("Enter")
				end)
				task.wait(5)
			end
		end)
	end
end)

print("âœ… Auto Tower System Loaded Successfully")
